# Fail2Ban filter for Asterisk PJSIP authentication failures
# Detects: Invalid passwords, failed ACLs, wrong accounts, brute force attempts
[Definition]

# PJSIP Security Events (Asterisk 13+)
failregex = ^.*SecurityEvent="(FailedACL|InvalidAccountID|ChallengeResponseFailed|InvalidPassword)".*RemoteAddress="IPV[46]/(UDP|TCP|TLS)/<HOST>/[0-9]+".*
            ^.*chan_sip\.c:.*Registration from '.*' failed for '<HOST>:[0-9]+' - Wrong password$
            ^.*chan_sip\.c:.*Registration from '.*' failed for '<HOST>:[0-9]+' - No matching peer found$
            ^.*chan_sip\.c:.*Registration from '.*' failed for '<HOST>:[0-9]+' - Username/auth name mismatch$
            ^.*chan_sip\.c:.*Host <HOST> failed to authenticate as .*$
            ^.*chan_sip\.c:.*No registration for peer .*\(IPaddr: <HOST>\).*$
            ^.*res_pjsip_registrar\.c.*Endpoint.*: Registration.*failed for '<HOST>.*' - Authentication failed.*$
            ^.*res_pjsip\.c.*Request from '<HOST>' failed for '.*' \(callid: .*\) - Failed to authenticate.*$

ignoreregex =